_format_version: "3.0"
services:
  - name: mindsync-model-flask
    url: http://165.22.246.95:80/predict
    routes:
      - name: predict-route
        paths:
          - /v0-1/model-predict
  - name: mindsync-model-advice
    url: http://165.22.246.95:80/advice
    routes:
      - name: advice-route
        paths:
          - /v0-1/model-advice
  - name: mindsync-model-result
    url: http://165.22.246.95:80/result
    routes:
      - name: result-route
        paths:
          - /v0-1/model-result
  - name: mindsync-model-history
    url: http://165.22.246.95:80/history
    routes:
      - name: history-route
        paths:
          - /v0-1/model-history
  - name: mindsync-model-streak
    url: http://165.22.246.95:80/streak
    routes:
      - name: streak-route
        paths:
          - /v0-1/model-streak
  - name: mindsync-model-weekly-chart
    url: http://165.22.246.95:80/chart/weekly
    routes:
      - name: weekly-chart-route
        paths:
          - /v0-1/model-weekly-chart/(?<user_id>[^/]+)
        plugins:
          - name: request-transformer
            config:
              add:
                querystring: ["user_id:$(uri_captures['user_id'])"]
  - name: mindsync-model-critical-factors
    url: http://165.22.246.95:80/weekly-critical-factors
    routes:
      - name: critical-factors-route
        paths:
          - /v0-1/model-critical-factors
  - name: mindsync-model-daily-suggestion
    url: http://165.22.246.95:80/daily-suggestion
    routes:
      - name: daily-suggestion-route
        paths:
          - /v0-1/model-daily-suggestion
  - name: mindsync-auth-login
    url: http://188.166.233.241:80/login
    routes:
      - name: login-route
        paths:
          - /v0-1/auth-login
  - name: mindsync-auth-register
    url: http://188.166.233.241:80/register
    routes:
      - name: register-route
        paths:
          - /v0-1/auth-register
  - name: mindsync-auth-profile
    url: http://188.166.233.241:80/profile
    routes:
      - name: profile-route
        paths:
          - /v0-1/auth-profile
plugins:
  - name: cors
    config:
      origins:
        - "*"
      methods:
        - GET
        - POST
        - PUT
        - PATCH
        - DELETE
        - OPTIONS
      headers:
        - Accept
        - Accept-Version
        - Content-Length
        - Content-MD5
        - Content-Type
        - Date
        - X-Auth-Token
      exposed_headers:
        - X-Auth-Token
      credentials: true
      max_age: 3600
  - name: file-log
    config:
      path: /dev/stdout
      reopen: false
